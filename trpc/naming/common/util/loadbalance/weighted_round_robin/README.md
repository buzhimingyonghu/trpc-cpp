# `InnerEndpointInfos` 结构体

`InnerEndpointInfos` 结构体用于存储服务节点的信息和权重，具体定义如下：

```cpp
struct InnerEndpointInfos {
    std::vector<int> weights;            // 保存每个节点的初始权重
    std::vector<TrpcEndpointInfo> endpoints;  // 保存每个节点的信息
    std::vector<int> current_weights;    // 保存每个节点的当前权重
    std::uint32_t total_weight;          // 所有节点权重的总和
};
```

## 更新过程

### 初始化

- 初始化 `InnerEndpointInfos` 对象，存储新的服务节点列表、对应的权重和初始为 0 的当前权重。
- 计算所有节点的权重总和，并将新信息更新到 `callee_router_infos_` 中。

### 节点选择

1. 获取节点信息：根据 `result.info->name` 找到对应的负载均衡信息。
2. 节点选择：
   - 遍历所有节点，将每个节点的当前权重累加其初始权重。
   - 找出当前权重最高的节点，记录其索引。

### 权重调整

选中节点后，减去所有节点的权重总和 `info.total_weight`，这一步确保下一次轮询时权重较高的节点不会连续被选中。

## 示例

假设有三个节点 A、B、C，它们的权重分别为 5、1、1。初始时，各节点的当前权重为 0。

### 第一次请求：

- A：0 + 5 = 5
- B：0 + 1 = 1
- C：0 + 1 = 1

选择 A，因为 A 的当前权重最高。然后 A 的当前权重变为 5 - (5 + 1 + 1) = -2。

### 第二次请求：

- A：-2 + 5 = 3
- B：1 + 1 = 2
- C：1 + 1 = 2

选择 A，因为 A 的当前权重仍然最高。然后 A 的当前权重变为 3 - (5 + 1 + 1) = -4。

### 第三次请求：

- A：-4 + 5 = 1
- B：2 + 1 = 3
- C：2 + 1 = 3

选择 B（或 C），因为 B 和 C 的当前权重相同且最高。然后 B 的当前权重变为 3 - (5 + 1 + 1) = -4。
通过这个过程，可以看到虽然 A 的权重最高，但它不会在每次轮询中都被选中。随着轮询次数的增加，各节点的选择机会逐渐接近其权重比例，实现平滑的负载均衡。
